# https://hub.docker.com/r/osixia/openldap/tags

docker pull osixia/openldap:latest
Status: Downloaded newer image for osixia/openldap:latest
docker.io/osixia/openldap:latest


 % docker run  -p 389:389 -p 636:636 --name my-openldap-container --detach osixia/openldap
4d390ca0fec6932ede1f4d21f38409eb200be2743fd443620ed170d50f165e2a



%docker exec my-openldap-container ldapsearch -x -H ldap://localhost -b dc=example,dc=org -D "cn=admin,dc=example,dc=org" -w admin
# extended LDIF
#
# LDAPv3
# base <dc=example,dc=org> with scope subtree
# filter: (objectclass=*)
# requesting: ALL
#

# example.org
dn: dc=example,dc=org
objectClass: top
objectClass: dcObject
objectClass: organization
o: Example Inc.
dc: example

# search result
search: 2
result: 0 Success

# numResponses: 2
# numEntries: 1


% docker pull osixia/phpldapadmin:latest
Status: Downloaded newer image for osixia/phpldapadmin:latest
docker.io/osixia/phpldapadmin:latest


docker run -p 6443:443 \
        --env PHPLDAPADMIN_LDAP_HOSTS=localhost \
        --detach osixia/phpldapadmin


docker: Error response from daemon: driver failed programming external connectivity on endpoint youthful_hopper (e13b39ad5c1fb89caebe345a1709d21c0dc12ab328e3318c0f8f9a9017f7c093): listen tcp4 0.0.0.0:6443: bind: address already in use.


docker run -p 9443:443 \
        --env PHPLDAPADMIN_LDAP_HOSTS=localhost \
        --detach osixia/phpldapadmin


https://localhost:9443/

登陆失败

% docker images |grep ldap
osixia/phpldapadmin                                               latest                                                      9e4eb6220ea9   9 months ago    300MB
osixia/openldap                                                   latest                                                      ead7cc4a281e   9 months ago    255MB



 % docker ps |grep ldap
023e2731c5b3   osixia/phpldapadmin                                                         "/container/tool/run"    38 minutes ago      Up 38 minutes      80/tcp, 0.0.0.0:9443->443/tcp                 pedantic_buck
7cf436dca2c9   osixia/openldap                                                             "/container/tool/run"    About an hour ago   Up About an hour   0.0.0.0:389->389/tcp, 0.0.0.0:636->636/tcp    my-openldap-container


% docker stop 023e2731c5b3
023e2731c5b3
% docker rm 023e2731c5b3
023e2731c5b3
% docker stop 7cf436dca2c9
7cf436dca2c9
% docker rm 7cf436dca2c9
7cf436dca2c9



 docker run  -p 389:389 -p 636:636 --hostname ldap.example.org --name my-openldap-container --detach osixia/openldap

 17b86e8bfdca3dcd40beecaecac9f5a796f61a34e054bc60dabd0139ee540b37


  % docker exec my-openldap-container ldapsearch -x -H ldap://localhost -b dc=example,dc=org -D "cn=admin,dc=example,dc=org" -w admin
# extended LDIF
#
# LDAPv3
# base <dc=example,dc=org> with scope subtree
# filter: (objectclass=*)
# requesting: ALL
#

# example.org
dn: dc=example,dc=org
objectClass: top
objectClass: dcObject
objectClass: organization
o: Example Inc.
dc: example

# search result
search: 2
result: 0 Success

# numResponses: 2
# numEntries: 1

docker run -p 9443:443 \
        --env PHPLDAPADMIN_LDAP_HOSTS=ldap.example.org \
        --detach osixia/phpldapadmin

28de446cb5387696cfa2be769b2d397421c543ce94ca38280dbb84c46e2b33e6

https://localhost:9443/cmd.php?cmd=login_form&server_id=1&redirect=true


cn=admin,dc=example,dc=org
admin
失败

Can't contact LDAP server (-1) for user


 % docker ps |grep ldap
28de446cb538   osixia/phpldapadmin                                                         "/container/tool/run"    3 minutes ago    Up 3 minutes    80/tcp, 0.0.0.0:9443->443/tcp                 upbeat_joliot
17b86e8bfdca   osixia/openldap                                                             "/container/tool/run"    5 minutes ago    Up 5 minutes    0.0.0.0:389->389/tcp, 0.0.0.0:636->636/tcp    my-openldap-container

 % docker exec -it 17b86e8bfdca sh
#

# cat /container/service/slapd/assets/test/new-user.ldif
dn: uid=billy,dc=example,dc=org
uid: billy
cn: billy
sn: 3
objectClass: top
objectClass: posixAccount
objectClass: inetOrgPerson
loginShell: /bin/bash
homeDirectory: /home/billy
uidNumber: 14583102
gidNumber: 14564100
userPassword: {SSHA}j3lBh1Seqe4rqF1+NuWmjhvtAni1JC5A
mail: billy@example.org
gecos: Billy User


# touch /container/service/slapd/assets/test/base.ldif
#ldapadd -x -D "cn=admin,dc=example,dc=org" -W -f /container/service/slapd/assets/test/base.ldif -h ldap.example.org -p 389
Enter LDAP Password:


# ldapadd -x -D "cn=admin,dc=example,dc=org" -w admin -f /container/service/slapd/assets/test/new-user.ldif -H ldap://ldap.example.org -ZZ
adding new entry "uid=billy,dc=example,dc=org"


ldapadd -x -D "cn=admin,dc=example,dc=org" -w admin -f /container/service/slapd/assets/test/base.ldif -H ldap.example.org -ZZ

Could not parse LDAP URI(s)=ldap.example.org (3)



ldapadd -x -D "cn=admin,dc=example,dc=org" -w admin -f /container/service/slapd/assets/test/base.ldif -h ldap.example.org -ZZ



# ldapsearch -x -H ldap://localhost:389 -b dc=example,dc=org -D "cn=admin,dc=example,dc=org" -w admin
# extended LDIF
#
# LDAPv3
# base <dc=example,dc=org> with scope subtree
# filter: (objectclass=*)
# requesting: ALL
#

# example.org
dn: dc=example,dc=org
objectClass: top
objectClass: dcObject
objectClass: organization
o: Example Inc.
dc: example

# billy, example.org
dn: uid=billy,dc=example,dc=org
uid: billy
cn: billy
sn: 3
objectClass: top
objectClass: posixAccount
objectClass: inetOrgPerson
loginShell: /bin/bash
homeDirectory: /home/billy
uidNumber: 14583102
gidNumber: 14564100
userPassword:: e1NTSEF9ajNsQmgxU2VxZTRycUYxK051V21qaHZ0QW5pMUpDNUE=
mail: billy@example.org
gecos: Billy User

# search result
search: 2
result: 0 Success

# numResponses: 3
# numEntries: 2


用户名:admin,dc=example,dc=org 密码:admin

Unable to connect to LDAP server ldap.example.org
Error: Can't contact LDAP server (-1) for user



% docker kill 17b86e8bfdca
17b86e8bfdca
% docker rm 17b86e8bfdca
17b86e8bfdca


docker run -p 9443:443 \
        --env PHPLDAPADMIN_LDAP_HOSTS=ldap.example.org \
        --link my-openldap-container \
        --detach osixia/phpldapadmin 


加--link后成功了
cn=admin,dc=example,dc=org
admin
