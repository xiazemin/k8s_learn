 % git submodule add https://github.com/prometheus/client_golang

 https://github.com/prometheus/client_golang


 Counter（计数器）
counter 是一个累计的指标，代表一个单调递增的计数器，它的值只会增加或在重启时重置为零。例如，你可以使用 counter 来代表服务过的请求数，完成的任务数，或者错误的次数。

Gauge（计量器）
gauge 是代表一个数值类型的指标，它的值可以增或减。gauge 通常用于一些度量的值例如温度或是当前内存使用，也可以用于一些可以增减的“计数”，如正在运行的 Goroutine 个数。

Histogram（分布图）
histogram 对观测值（类似请求延迟或回复包大小）进行采样，并用一些可配置的桶来计数。它也会给出一个所有观测值的总和。

Summary（摘要）
跟 histogram 类似，summary 也对观测值（类似请求延迟或回复包大小）进行采样。同时它会给出一个总数以及所有观测值的总和，它在一个滑动的时间窗口上计算可配置的分位数。

https://studygolang.com/articles/17959

https://www.cnblogs.com/charlieroro/archive/2018/03/29/8670959.html

https://studygolang.com/articles/30738?fr=sidebar



当我们配置了Histogram数据类型后，我们能得到：

每个桶中累积值的数量。这里的“桶”就是上面横轴的数值（5,10,15,20），而累计值不是上面的竖轴的值，而是一个累积计数，上图中5的桶对应的累积值是2,10的桶对应的累积值是4,15的桶对应的累积值对应的是8,20的桶对应的是10
所有样本值的总和，比如上图中在形成柱状图之前，我们的数据应该是10天的温度（假设温度只在5,10,15,20中取值）,然后统计出对应温度的天数而形成柱状图。此处的总和就是10天温度的总和
样本数量，对应上图就是10了
Summary
这种类型类似于Histogram，他们都提供了样本值的总和和样本数量。但是Summary没有提供每个桶中的累积值，而是提供了一个 φ-quantiles。

φ-quantiles
说一下 φ-quantiles吧。 φ-quantiles中的φ的取值范围是0 ≤ φ ≤ 1，总体的意思就是，如果你有N个样本值，首先要从小到大排序，然后取出排在φ *N的值。
histogram_quantile
这是Histogram类型计算φ-quantiles时用的函数。这个函数的逻辑是，（1）最高的桶的上线如果不是+Inf，那么返回NaN （2）如果quantile 落在最高的桶，那么会返回最高桶的下线值 （3）如果最低桶的上限是大于0的，那么就会使用插值的方式。如果最低同的上限小于等于0，那么就会返回最低桶的上限
Quantile error
我觉得可以翻译成误差，对于Histogram来说，比如我们有一个200ms 到 300ms的桶，我们的值都接近于220ms，所以0.95-quantiles应该接近于220ms，但是实际上，PrometheUS会使用插值的方法计算φ-quantiles，那么取值就会是295ms
而对于Summary来说，上面的情况不会出现。但是Summary在定义φ-quantiles的时候，会定义一个波动范围，那么实际上φ-quantiles的计算会在φ加减波动范围内波动，如果这个范围内值的波动范围很大，那么取值就会不准确了

https://blog.csdn.net/u014686399/article/details/103068655/