% go build -o matrix .

% docker build -t matrix .

% kubectl apply -f deployment.yaml              

standard_init_linux.go:228: exec user process caused: exec format error

https://blog.csdn.net/HermitSun/article/details/109145856


CGO_ENABLED=0 GOOS=linux GOARCH=amd64 go build -o matrix .


https://prometheus.fuckcloudnative.io/di-san-zhang-prometheus/di-2-jie-an-zhuang/gettingstarted

https://www.cnblogs.com/YaoDD/p/11391310.html


访问http://127.0.0.1:30090/config可以看到当前prometheus的配置

endpoint信息交由prometheus，prometheus就可以得到抓取地址了，为__scheme__://__address____metrics_path__，也即http://192.168.65.3:9100/metrics，最终在prometheus的targets里会看到

https://jeremyxu2010.github.io/2018/11/%E4%BD%BF%E7%94%A8prometheus%E7%9B%91%E6%8E%A7%E5%A4%9Ak8s%E9%9B%86%E7%BE%A4/


kind: ConfigMap

scrape_configs:
  - job_name: prometheus
      static_configs:
        - targets: ['traefik-ingress-service.kube-system.svc.cluster.local:8080']

https://www.qikqiak.com/post/promethues-monitor-k8s-app/



配置文件中包含了3个模块：global、rule_files 和 scrape_configs。

global 模块控制 Prometheus Server 的全局配置：

scrape_interval：表示 prometheus 抓取指标数据的频率，默认是15s，我们可以覆盖这个值
evaluation_interval：用来控制评估规则的频率，prometheus 使用规则产生新的时间序列数据或者产生警报
rule_files：指定了报警规则所在的位置，prometheus 可以根据这个配置加载规则，用于生成新的时间序列数据或者报警信息，当前我们没有配置任何报警规则。

scrape_configs 用于控制 prometheus 监控哪些资源。

由于 prometheus 通过 HTTP 的方式来暴露的它本身的监控数据，prometheus 也能够监控本身的健康情况。在默认的配置里有一个单独的 job，叫做 prometheus，它采集 prometheus 服务本身的时间序列数据。这个 job 包含了一个单独的、静态配置的目标：监听 localhost 上的 9090 端口。prometheus 默认会通过目标的 /metrics 路径采集 metrics。所以，默认的 job 通过 URL：http://localhost:9090/metrics 采集 metrics。收集到的时间序列包含 prometheus 服务本身的状态和性能。如果我们还有其他的资源需要监控的话，直接配置在 scrape_configs 模块下面就可以了。

https://www.qikqiak.com/k8strain/monitor/prometheus/


 % kubectl get configMap prometheus-config -n prom -o yaml > prometheus-config.yaml

     - job_name: 'kubernetes-matrix-xzm'
      static_configs:
        - targets: ['matrix-deployment.default.svc:12345']

% kubectl  apply -f prometheus-config.yaml
configmap/prometheus-config configured


http://127.0.0.1:30090/targets

可以看到
kubernetes-matrix-xzm (1/1 up) 
Endpoint	State	Labels	Last Scrape	Error
http://matrix-deployment.default.svc:12345/metrics



Namespace: "our_company",
Subsystem: "blob_storage",
Name:      "ops_queued",


可以搜到our_company_blob_storage_ops_queued
