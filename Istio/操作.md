https://istio.io/latest/zh/docs/setup/platform-setup/docker/

curl -L https://istio.io/downloadIstio | sh -

 % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
100   102  100   102    0     0    102      0  0:00:01 --:--:--  0:00:01   102
100  4549  100  4549    0     0   1999      0  0:00:02  0:00:02 --:--:--  6189

Downloading istio-1.12.1 from https://github.com/istio/istio/releases/download/1.12.1/istio-1.12.1-osx.tar.gz ...
Istio 1.12.1 Download Complete!

Istio has been successfully downloaded into the istio-1.12.1 folder on your system.

Next Steps:
See https://istio.io/latest/docs/setup/install/ to add Istio to your Kubernetes cluster.

To configure the istioctl client tool for your workstation,
add the /Users/xiazemin/source/k8s_learn/Istio/istio-1.12.1/bin directory to your environment path variable with:
         export PATH="$PATH:/Users/xiazemin/source/k8s_learn/Istio/istio-1.12.1/bin"

Begin the Istio pre-installation check by running:
         istioctl x precheck 

Need more information? Visit https://istio.io/latest/docs/setup/install/ 



https://www.qikqiak.com/istio-book/install/1.Docker%20for%20Mac%E5%AE%89%E8%A3%85istio.html


% helm install install/kubernetes/helm/istio --name istio --namespace istio-system --set tracing.enabled=true --set kiali.enabled=true --set grafana.enabled=true

% kubectl apply -f <(istioctl kube-inject -f samples/bookinfo/platform/kube/bookinfo.yaml)

https://my.oschina.net/u/2306127/blog/1793740
https://istio.io/latest/zh/docs/setup/getting-started/#download

%  export PATH="$PATH:/Users/xiazemin/source/k8s_learn/Istio/istio-1.12.1/bin"

 %  istioctl x precheck 
✔ No issues found when checking the cluster. Istio is safe to install or upgrade!
  To get started, check out https://istio.io/latest/docs/setup/getting-started/


 % istioctl install --set profile=istio-demo -y
Error: generate config: failed to read profile istio-demo from : open profiles/istio-demo.yaml: file does not exist

对于本次安装，我们采用 demo 配置组合。 选择它是因为它包含了一组专为测试准备的功能集合，另外还有用于生产或性能测试的配置组合。
% istioctl profile list 
Istio configuration profiles:
    default
    demo
    empty
    external
    minimal
    openshift
    preview
    remote
https://istio.io/latest/zh/docs/setup/additional-setup/config-profiles/


istioctl install --set profile=demo -y

- Processing resources for Egress gateways, Ingress gateways. Waiting for Deployment/istio-system/istio-egressgateway, Deployment/ist...


% istioctl install --set profile=demo -y      
✔ Istio core installed                                                                                                                  
✔ Istiod installed                                                                                                                      
✘ Egress gateways encountered an error: failed to wait for resource: resources not ready after 5m0s: timed out waiting for the condition
  
✘ Ingress gateways encountered an error: failed to wait for resource: resources not ready after 5m0s: timed out waiting for the condition
  
- Pruning removed resources                                                                                                             Error: failed to install manifests: errors occurred during operation

看样子应该是第一次安装时pull镜像时间太长，所以前台5分钟等待的监测一直不能就绪。 但是第二次也这么提示就不知道啥原因了，我第三次加了--charts才成功
https://blog.51cto.com/docker/2518498
https://stackoverflow.com/questions/64373346/istioctl-install-fails-with-multiple-timeouts
https://blog.csdn.net/Mr_rsq/article/details/107834698


https://istio.io/latest/zh/docs/setup/install/istioctl/
在安装 Istio 之前，可以用 manifest generate 子命令生成清单文件。 例如，用下面命令生成 default 配置档的清单文件：
istioctl manifest generate > ./generated-manifest.yaml

https://blog.csdn.net/weixin_28876083/article/details/112414337

 https://github.com/istio/istio/issues/24056

  % kubectl get pod -n istio-system
NAME                                    READY   STATUS    RESTARTS   AGE
istio-egressgateway-687f4db598-gwcck    0/1     Pending   0          76m
istio-ingressgateway-78f69bd5db-79nct   0/1     Pending   0          76m
istiod-76d66d9876-nb5sj                 1/1     Running   0          77m



% kubectl -n istio-system  describe pod istio-ingressgateway-78f69bd5db-79nct
Name:           istio-ingressgateway-78f69bd5db-79nct
Namespace:      istio-system
Priority:       0
Node:           <none>
Labels:         app=istio-ingressgateway
                chart=gateways
                heritage=Tiller
                install.operator.istio.io/owning-resource=unknown
                istio=ingressgateway
                istio.io/rev=default
                operator.istio.io/component=IngressGateways
                pod-template-hash=78f69bd5db
                release=istio
                service.istio.io/canonical-name=istio-ingressgateway
                service.istio.io/canonical-revision=latest
                sidecar.istio.io/inject=false
Annotations:    prometheus.io/path: /stats/prometheus
                prometheus.io/port: 15020
                prometheus.io/scrape: true
                sidecar.istio.io/inject: false
Status:         Pending
IP:             
IPs:            <none>
Controlled By:  ReplicaSet/istio-ingressgateway-78f69bd5db
Containers:
  istio-proxy:
    Image:       docker.io/istio/proxyv2:1.12.1
    Ports:       15021/TCP, 8080/TCP, 8443/TCP, 31400/TCP, 15443/TCP, 15090/TCP
    Host Ports:  0/TCP, 0/TCP, 0/TCP, 0/TCP, 0/TCP, 0/TCP
    Args:
      proxy
      router
      --domain
      $(POD_NAMESPACE).svc.cluster.local
      --proxyLogLevel=warning
      --proxyComponentLogLevel=misc:error
      --log_output_level=default:info 
    Limits:
      cpu:     2
      memory:  1Gi
    Requests:
      cpu:      10m
      memory:   40Mi
    Readiness:  http-get http://:15021/healthz/ready delay=1s timeout=1s period=2s #success=1 #failure=30
    Environment:
      JWT_POLICY:                   third-party-jwt
      PILOT_CERT_PROVIDER:          istiod
      CA_ADDR:                      istiod.istio-system.svc:15012
      NODE_NAME:                     (v1:spec.nodeName)
      POD_NAME:                     istio-ingressgateway-78f69bd5db-79nct (v1:metadata.name)
      POD_NAMESPACE:                istio-system (v1:metadata.namespace)
      INSTANCE_IP:                   (v1:status.podIP)
      HOST_IP:                       (v1:status.hostIP)
      SERVICE_ACCOUNT:               (v1:spec.serviceAccountName)
      ISTIO_META_WORKLOAD_NAME:     istio-ingressgateway
      ISTIO_META_OWNER:             kubernetes://apis/apps/v1/namespaces/istio-system/deployments/istio-ingressgateway
      ISTIO_META_MESH_ID:           cluster.local
      TRUST_DOMAIN:                 cluster.local
      ISTIO_META_UNPRIVILEGED_POD:  true
      ISTIO_META_CLUSTER_ID:        Kubernetes
    Mounts:
      /etc/istio/config from config-volume (rw)
      /etc/istio/ingressgateway-ca-certs from ingressgateway-ca-certs (ro)
      /etc/istio/ingressgateway-certs from ingressgateway-certs (ro)
      /etc/istio/pod from podinfo (rw)
      /etc/istio/proxy from istio-envoy (rw)
      /var/lib/istio/data from istio-data (rw)
      /var/run/secrets/istio from istiod-ca-cert (rw)
      /var/run/secrets/kubernetes.io/serviceaccount from kube-api-access-vczgw (ro)
      /var/run/secrets/tokens from istio-token (ro)
Conditions:
  Type           Status
  PodScheduled   False 
Volumes:
  istiod-ca-cert:
    Type:      ConfigMap (a volume populated by a ConfigMap)
    Name:      istio-ca-root-cert
    Optional:  false
  podinfo:
    Type:  DownwardAPI (a volume populated by information about the pod)
    Items:
      metadata.labels -> labels
      metadata.annotations -> annotations
  istio-envoy:
    Type:       EmptyDir (a temporary directory that shares a pod's lifetime)
    Medium:     
    SizeLimit:  <unset>
  istio-data:
    Type:       EmptyDir (a temporary directory that shares a pod's lifetime)
    Medium:     
    SizeLimit:  <unset>
  istio-token:
    Type:                    Projected (a volume that contains injected data from multiple sources)
    TokenExpirationSeconds:  43200
  config-volume:
    Type:      ConfigMap (a volume populated by a ConfigMap)
    Name:      istio
    Optional:  true
  ingressgateway-certs:
    Type:        Secret (a volume populated by a Secret)
    SecretName:  istio-ingressgateway-certs
    Optional:    true
  ingressgateway-ca-certs:
    Type:        Secret (a volume populated by a Secret)
    SecretName:  istio-ingressgateway-ca-certs
    Optional:    true
  kube-api-access-vczgw:
    Type:                    Projected (a volume that contains injected data from multiple sources)
    TokenExpirationSeconds:  3607
    ConfigMapName:           kube-root-ca.crt
    ConfigMapOptional:       <nil>
    DownwardAPI:             true
QoS Class:                   Burstable
Node-Selectors:              <none>
Tolerations:                 node.kubernetes.io/not-ready:NoExecute op=Exists for 300s
                             node.kubernetes.io/unreachable:NoExecute op=Exists for 300s
Events:
  Type     Reason            Age   From               Message
  ----     ------            ----  ----               -------
  Warning  FailedScheduling  78m   default-scheduler  0/1 nodes are available: 1 node(s) didn't match Pod's node affinity/selector.



 % docker pull docker.io/istio/proxyv2:1.12.1
1.12.1: Pulling from istio/proxyv2

https://stackoverflow.com/questions/68417427/istio-installation-failure
% export KUBECONFIG=~/.kube/config


https://github.com/istio/istio/issues/32751#issuecomment-837235830

https://github.com/istio/istio/releases/download/1.12.1/istio-1.12.1-linux-arm64.tar.gz

https://github.com/istio/istio/releases/tag/1.12.1

https://github.com/istio/istio/issues/30829



% kubectl -n istio-system get deploy
NAME                   READY   UP-TO-DATE   AVAILABLE   AGE
istio-egressgateway    0/1     1            0           3h52m
istio-ingressgateway   0/1     1            0           3h52m
istiod                 1/1     1            1           3h53m


https://istio.io/latest/zh/docs/setup/install/istioctl/


安装 Istio 的核心部分：kubectl apply -f install/kubernetes/istio.yaml
https://blog.csdn.net/guobingrong/article/details/78630241

% helm version
zsh: command not found: helm

 % brew install kubernetes-helm
Updating Homebrew...

https://www.jianshu.com/p/131bf15235b1

brew install kubernetes-helm
Updating Homebrew...
Error: Cannot install under Rosetta 2 in ARM default prefix (/opt/homebrew)!
To rerun under ARM use:
    arch -arm64 brew install ...
To install under x86_64, install Homebrew into /usr/local.

iterms


% brew install kubernetes-helm
==> Downloading https://mirrors.ustc.edu.cn/homebrew-bottles/helm-3.7.1.arm64_big_sur.bottle.tar.gz
#=#=#
curl: (22) The requested URL returned error: 404
Warning: Bottle missing, falling back to the default domain...
==> Downloading https://ghcr.io/v2/homebrew/core/helm/manifests/3.7.1
######################################################################## 100.0%
==> Downloading https://ghcr.io/v2/homebrew/core/helm/blobs/sha256:3ff5c5ebf92f73bf50637c24d5579b7608aa3dc8618244b7389f061bfe4875f1
==> Downloading from https://pkg-containers.githubusercontent.com/ghcr1/blobs/sha256:3ff5c5ebf92f73bf50637c24d5579b7608aa3dc8618244b7389f061bfe4875f1?se=2022-01-03T07%3A
######################################################################## 100.0%^@
==> Pouring helm--3.7.1.arm64_big_sur.bottle.tar.gz
==> Caveats
zsh completions have been installed to:
  /opt/homebrew/share/zsh/site-functions
==> Summary
🍺  /opt/homebrew/Cellar/helm/3.7.1: 60 files, 51.4MB



 % helm version                
version.BuildInfo{Version:"v3.7.1", GitCommit:"1d11fcb5d3f3bf00dbe6fe31b8412839a96b3dc4", GitTreeState:"clean", GoVersion:"go1.17.2"}


 % istioctl version
client version: 1.12.1
control plane version: 1.12.1
data plane version: none

https://blog.51cto.com/zero01/2569376

http://www.huilog.com/?p=1328

https://www.orchome.com/9952

https://developer.aliyun.com/packageSearch?word=istio

中的 gcr.io/istio-release 5 全部替换为 docker.io/istio 87 就可以正常的下载镜像并部署成功了；
https://istio.cn/t/topic/34

