1,加载自动补全配置
 % source tools/istioctl.bash
 tools/istioctl.bash:type:253: bad option: -t
tools/istioctl.bash:256: command not found: complete

https://blog.csdn.net/xie1xiao1jun/article/details/100076142
在 ~/.bash_profile 或者 ~/.zshrc 中添加
autoload bashcompinit
bashcompinit

% source ~/istioctl.bash
/Users/xiazemin/istioctl.bash:type:253: bad option: -t
complete:13: command not found: compdef


% istioctl version
client version: 1.12.1
control plane version: 1.12.1
data plane version: 1.12.1 (3 proxies)

% istioctl version --remote=false
1.12.1




% istioctl manifest apply --set profile=demo
This will install the Istio 1.12.1 demo profile with ["Istio core" "Istiod" "Ingress gateways" "Egress gateways"] components into the cluster. Proceed? (y/N) y
✔ Istio core installed
✔ Istiod installed
✔ Egress gateways installed
✔ Ingress gateways installed
✔ Installation complete                                                                             Making this installation the default for injection and validation.

Thank you for installing Istio 1.12.  Please take a few minutes to tell us about your install/upgrade experience!  https://forms.gle/FegQbc9UvePd4Z9z7





% kubectl -n istio-system get all
NAME                                        READY   STATUS    RESTARTS   AGE
pod/istio-egressgateway-687f4db598-8dmmb    1/1     Running   0          54s
pod/istio-ingressgateway-78f69bd5db-tdbtw   1/1     Running   0          54s
pod/istiod-76d66d9876-hgsmt                 1/1     Running   0          61s

NAME                           TYPE           CLUSTER-IP      EXTERNAL-IP   PORT(S)                                                                      AGE
service/istio-egressgateway    ClusterIP      10.105.172.31   <none>        80/TCP,443/TCP                                                               54s
service/istio-ingressgateway   LoadBalancer   10.104.14.138   localhost     15021:31594/TCP,80:31760/TCP,443:30272/TCP,31400:30137/TCP,15443:32583/TCP   53s
service/istiod                 ClusterIP      10.108.137.91   <none>        15010/TCP,15012/TCP,443/TCP,15014/TCP                                        61s

NAME                                   READY   UP-TO-DATE   AVAILABLE   AGE
deployment.apps/istio-egressgateway    1/1     1            1           54s
deployment.apps/istio-ingressgateway   1/1     1            1           54s
deployment.apps/istiod                 1/1     1            1           61s

NAME                                              DESIRED   CURRENT   READY   AGE
replicaset.apps/istio-egressgateway-687f4db598    1         1         1       54s
replicaset.apps/istio-ingressgateway-78f69bd5db   1         1         1       54s
replicaset.apps/istiod-76d66d9876                 1         1         1       61s



三个pod istiod ingress egress


service/istio-ingressgateway   LoadBalancer 改成 NodePort

 % kubectl -n istio-system patch svc istio-ingressgateway -p '{"spec":{"type":"NodePort"}}'
service/istio-ingressgateway patched


% kubectl -n istio-system get service/istio-ingressgateway
NAME                   TYPE       CLUSTER-IP      EXTERNAL-IP   PORT(S)                                                                      AGE
istio-ingressgateway   NodePort   10.104.14.138   <none>        15021:31594/TCP,80:31760/TCP,443:30272/TCP,31400:30137/TCP,15443:32583/TCP   6m52s



卸载
 % istioctl manifest generate --set profile=demo |kubectl delete -f



 % istioctl version
client version: 1.12.1
control plane version: 1.12.1
data plane version: 1.12.1 (2 proxies)
xiazemin@xiazemindeMBP istio-1.12.1 % istioctl analyze
Error [IST0101] (VirtualService default/reviews) Referenced host not found: "reviews"
Info [IST0102] (Namespace default) The namespace is not enabled for Istio injection. Run 'kubectl label namespace default istio-injection=enabled' to enable it, or 'kubectl label namespace default istio-injection=disabled' to explicitly mark it as not needing injection.
Error: Analyzers found issues when analyzing namespace: default.
See https://istio.io/v1.12/docs/reference/config/analysis for more information about causes and resolutions.


 % kubectl get VirtualService
NAME      GATEWAYS   HOSTS         AGE
reviews              ["reviews"]   61d


 % kubectl delete VirtualService reviews
virtualservice.networking.istio.io "reviews" deleted
xiazemin@xiazemindeMBP istio-1.12.1 % istioctl analyze
Info [IST0102] (Namespace default) The namespace is not enabled for Istio injection. Run 'kubectl label namespace default istio-injection=enabled' to enable it, or 'kubectl label namespace default istio-injection=disabled' to explicitly mark it as not needing injection.



 % kubectl get ns knative-serving
NAME              STATUS        AGE
knative-serving   Terminating   4d

% kubectl get ns knative-serving -o json > a.json
% vi a.json

    "spec": {
        "finalizers": [
        ]
    },

% kubectl proxy
Starting to serve on 127.0.0.1:8001


curl -k -H "Content-Type: application/json" -X PUT --data-binary @a.json http://127.0.0.1:8001/api/v1/namespaces/knative-serving/finalize


https://cloud.tencent.com/developer/article/1715263



