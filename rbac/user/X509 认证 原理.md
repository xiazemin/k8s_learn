https://zhuanlan.zhihu.com/p/36832100

目前我们所提到的数字证书都是基于 ITU 制定的 X.509 标准。

目前常用的非对称加密算法有 RSA、DSA 等。

将各种不定长的「数据」经过某种算法处理之后，总是能生成一段定长的数据。这段定长的数据称之为「散列值」。

这种算法如果可以满足以下特征，则可以称为摘要算法。

可以轻松地将各种不定长的「数据」生成「散列值」。
不能通过「散列值」来反推出原「数据」。
不能找出具有相同「散列值」的另一个「数据」。
目前常用的摘要算法有 MD5、SHA-1、SHA-256 等


数字签名
数字签名其实就是把「散列值」经过非对称加密算法加密得到的一个「加密的散列值」。

X.509 数字证书结构:数字证书就是一张附带了数字签名的信息表。


常见的信息窃取方式
假冒服务器  DNS 欺骗
中间人攻击   ARP 欺骗、DNS 欺骗

3.1 根认证机构的构建
简要流程

根认证机构「CA」生成公钥 ca_KeyPub 和私钥 ca_KeyPri，以及基本信息表 ca_Info。ca_Info 中一般包含了「CA」的名称、证书的有效期等信息。
根认证机构「CA」对（ca_KeyPub + ca_Info）进行散列运算，得到散列值 ca_Hash。
根认证机构「CA」使用其私钥 ca_KeyPri 对 ca_Hash 进行非对称加密，得到加密的散列值 enc_ca_Hash。
根认证机构「CA」将（ca_KeyPub + ca_Info + enc_ca_Hash）组合生成自签名的数字证书「ca_Cert」。这张证书称之为根证书。
根证书「ca_Cert」包含的内容：ca_KeyPub + ca_Info + enc_ca_Hash。

「ca_Cert」可用于签署下一级的证书。

3.2 单级认证机构的证书签署
简要流程

服务器「S」生成公钥 s_KeyPub 和私钥 s_KeyPri，以及基本信息表 s_Info。s_Info 中一般包含了「S」的名称、证书要求的有效期等信息。
服务器「S」将 s_KeyPub、s_Info 送给根认证机构「CA」。
根认证机构「CA」通过某种方式验证「S」的身份之后，再加上根认证机构自己的一些信息 ca_Info，然后对它们（s_KeyPub + s_Info + ca_Info）进行散列运算，得到散列值 s_Hash。
根认证机构「CA」使用其私钥 ca_KeyPri 对 s_Hash 进行非对称加密，得到加密的散列值 enc_s_Hash。
根认证机构「CA」将（s_KeyPub + s_Info + ca_Info + enc_s_Hash）组合签署成数字证书「s_Cert」并回送给「S」。
服务器证书「s_Cert」包含的内容：s_KeyPub + s_Info + ca_Info + enc_s_Hash。

「s_Cert」不可用于签署下一级的证书。


3.3 二级（或以上）认证机构的构建
在现实中，仅仅靠一个认证机构是满足不了海量证书签署需求的，因此需要构建分支认证机构。
简要流程

二级认证机构「CA2」生成公钥 ca2_KeyPub 和私钥 ca2_KeyPri，以及基本信息表 ca2_Info。ca2_Info 中一般包含了「CA2」的名称、证书要求的有效期等信息。
二级认证机构「CA2」将 ca2_KeyPub、ca2_Info 送给根认证机构「CA」。
根认证机构「CA」通过某种方式验证「CA2」的身份之后，再加上根认证机构自己的一些信息 ca_Info，然后对它们（ca2_KeyPub + ca2_Info + ca_Info）进行散列运算，得到散列值 ca2_Hash。
根认证机构「CA」使用其私钥 ca_KeyPri 对 ca2_Hash 进行非对称加密，得到加密的散列值 enc_ca2_Hash。
根认证机构「CA」将（ca2_KeyPub + ca2_Info + ca_Info + enc_ca2_Hash）组合签署成数字证书「ca2_Cert」并回送给「CA2」。
二级认证机构证书「ca2_Cert」包含的内容：ca2_KeyPub + ca2_Info + ca_Info + enc_ca2_Hash。

「ca2_Cert」可用于签署下一级的证书。

三级或更多级认证机构的构建流程跟这个流程差不多，这里就不再赘述了。

3.4 二级（或以上）认证机构的证书签署
简要流程

服务器「S2」生成公钥 s2_KeyPub 和私钥 s2_KeyPri，以及基本信息表 s2_Info。s2_Info 中一般包含了「S2」的名称、证书要求的有效期等信息。
服务器「S2」将 s2_KeyPub、s2_Info 送给二级认证机构「CA2」。
二级认证机构「CA2」通过某种方式验证「S2」的身份之后，再加上根认证机构自己的一些信息 ca2_Info，然后对它们（s2_KeyPub + s2_Info + ca2_Info）进行散列运算，得到散列值 s2_Hash。
二级认证机构「CA2」使用其私钥 ca2_KeyPri 对 s2_Hash 进行非对称加密，得到加密的散列值 enc_s2_Hash。
二级认证机构「CA2」将（s2_KeyPub + s2_Info + ca2_Info + enc_s2_Hash）组合签署成数字证书「s2_Cert」并回送给「S2」。
服务器证书「s2_Cert」包含的内容：s2_KeyPub + s2_Info + ca2_Info + enc_s2_Hash。

「s2_Cert」不可用于签署下一级的证书。

三级或更多级认证机构证书签署流程跟这个流程差不多，也不再赘述了。

从上面可以看出，证书签署的流程是：「ca_Cert」-> 「ca2_Cert」->「s2_Cert」。它是一条完整的链条，我们把它称之为「证书链」


