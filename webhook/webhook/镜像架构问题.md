 % docker run -it --privileged --pid=host alpine:latest nsenter -t 1 -m -u -n -i sh
/ # uname -a
Linux docker-desktop 5.10.47-linuxkit #1 SMP PREEMPT Sat Jul 3 21:50:16 UTC 2021 aarch64 Linux

% CGO_ENABLED=0 GOOS=linux GOARCH=arm64 go build -o webhook .
% docker build -t webhook-example:0.0.1 . 

% kubectl describe pod admission-webhook-example-deployment-5d66985494-22wgd

Events:
  Type     Reason     Age                     From               Message
  ----     ------     ----                    ----               -------
  Normal   Scheduled  5m2s                    default-scheduler  Successfully assigned default/admission-webhook-example-deployment-5d66985494-22wgd to docker-desktop
  Normal   Pulled     3m37s (x5 over 5m1s)    kubelet            Container image "docker.io/library/webhook-example:0.0.1" already present on machine
  Normal   Created    3m37s (x5 over 5m1s)    kubelet            Created container admission-webhook-example
  Warning  Failed     3m37s (x5 over 5m1s)    kubelet            Error: failed to start container "admission-webhook-example": Error response from daemon: OCI runtime create failed: container_linux.go:380: starting container process caused: exec: "-tlsCertFile=/etc/webhook/certs/cert.pem": stat -tlsCertFile=/etc/webhook/certs/cert.pem: no such file or directory: unknown
  Warning  BackOff    2m56s (x10 over 4m31s)  kubelet            Back-off restarting failed container


RUN mkdir -p /etc/webhook/certs/

 => => transferring context: 2B                                                                                                0.0s
 => ERROR [1/5] RUN mkdir -p /etc/webhook/certs/  

去掉
 /etc/webhook/certs/

 docker build -t webhook-example:0.0.2 

 % docker rmi webhook-example:0.0.1 

 Warning  Failed     2s (x3 over 14s)  kubelet            Error: failed to start container "admission-webhook-example": Error response from daemon: OCI runtime create failed: container_linux.go:380: starting container process caused: exec: "-tlsCertFile=cert.pem": executable file not found in $PATH: unknown


  Error: failed to start container "admission-webhook-example": Error response from daemon: OCI runtime create failed: container_linux.go:380: starting container process caused: process_linux.go:545: container init caused: rootfs_linux.go:76: mounting "/var/lib/docker/containers/64eb1394a4b68ef491af7da6ec839701f8ace68eecdcdd1bc530decb7856087d/resolv.conf" to rootfs at "/etc/resolv.conf" caused: open /var/lib/docker/overlay2/862d82e4af8f2a3ec6f8d5cf8227b4f7b93dbdf54bd51b1fccde2d5194789bb4/merged/etc/resolv.conf: read-only file system: unknown

  FROM alpine

ADD ./tmp/server-cert.pem /etc/webhook/certs/cert.pem
ADD ./tmp/server-key.pem /etc/webhook/certs/cert.pem

ADD ./tmp/server-cert.pem /etc/webhook/certs/cert.pem
ADD ./tmp/server-key.pem /etc/webhook/certs/key.pem


% docker run -it webhook-example:0.0.3 sh
/ # ls /etc/webhook/certs/
cert.pem  key.pem

./webhook


% docker ps |grep webhook
b88ef99ce8c9   k8s.gcr.io/pause:3.4.1                                                      "/pause"                 6 seconds ago   Up 5 seconds                                                 k8s_POD_admission-webhook-example-deployment-9bc957884-c85fz_default_21762147-4d13-46f5-9ab9-cf3895d66c0b_0


 % kubectl get pod |grep hook
admission-webhook-example-deployment-5bc4865848-v9fvb   1/1     Running     0          8s