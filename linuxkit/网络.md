/ # route
Kernel IP routing table
Destination     Gateway         Genmask         Flags Metric Ref    Use Iface
default         localhost       0.0.0.0         UG    202    0        0 eth0
10.1.0.0        *               255.255.0.0     U     0      0        0 cni0
127.0.0.0       *               255.0.0.0       U     0      0        0 lo
172.17.0.0      *               255.255.0.0     U     0      0        0 docker0
172.18.0.0      *               255.255.0.0     U     0      0        0 br-421a9e16d12b
192.168.65.0    *               255.255.255.0   U     202    0        0 eth0
192.168.65.5    *               255.255.255.255 UH    0      0        0 services1

https://www.netfilter.org/

wget https://www.netfilter.org/projects/iptables/files/iptables-1.8.2.tar.bz
2

/ # ping docker.for.mac.host.internal
PING docker.for.mac.host.internal (192.168.65.2): 56 data bytes
64 bytes from 192.168.65.2: seq=0 ttl=38 time=0.446 ms
64 bytes from 192.168.65.2: seq=1 ttl=38 time=0.287 ms
64 bytes from 192.168.65.2: seq=2 ttl=38 time=0.246 ms


/ # wget http://127.0.0.1:9909/main.go
Connecting to 127.0.0.1:9909 (127.0.0.1:9909)
wget: can't connect to remote host (127.0.0.1): Connection refused
/ # wget http://docker.for.mac.host.internal:9909/main.go
Connecting to docker.for.mac.host.internal:9909 (192.168.65.2:9909)
saving to 'main.go'
main.go              100% |********************************|   167  0:00:00 ETA
'main.go' saved


http://mirrors.163.com/centos/7/os/x86_64/Packages/
https://github.com/linuxkit/linuxkit/blob/master/docs/platform-hyperkit.md


https://unix.stackexchange.com/questions/338962/install-apk-tool-on-alpine-linux
https://dl-cdn.alpinelinux.org/alpine/v3.3/main/x86_64/

 wget http://dl-cdn.alpinelinux.org/alpine/v3.3/main/x86_64/apk-tools-static-
2.6.10-r0.apk
Connecting to dl-cdn.alpinelinux.org (151.101.110.133:80)
saving to 'apk-tools-static-2.6.10-r0.apk'
apk-tools-static-2.6 100% |********************************| 1591k  0:00:00 ETA^@
'apk-tools-static-2.6.10-r0.apk' saved


/ # ./sbin/apk.static add git
ERROR: Unable to lock database: No such file or directory
ERROR: Failed to open apk database: No such file or directory


echo http://mirror.yandex.ru/mirrors/alpine/v3.5/main > /etc/apk/repositories; 
echo http://mirror.yandex.ru/mirrors/alpine/v3.5/community >> /etc/apk/repositories

https://stackoverflow.com/questions/48736212/bad-file-descriptor-error-during-apk-update-in-docker-container-why


/ # ln ./sbin/apk.static /bin/apk

/ # apk info
WARNING: Ignoring APKINDEX.70f61090.tar.gz: Bad file descriptor
WARNING: Ignoring APKINDEX.ca2fea5b.tar.gz: Bad file descriptor

/bin/sh: can't create /etc/apk/repositories: Read-only file system

https://www.twblogs.net/a/5c2dbf03bd9eee35b3a48153


/ # cat etc/apk/repositories
http://dl-cdn.alpinelinux.org/alpine/v3.11/main
http://dl-cdn.alpinelinux.org/alpine/v3.11/community



https://dl-cdn.alpinelinux.org/alpine/v3.11/main/armv7/

wget http://dl-cdn.alpinelinux.org/alpine/v3.11/main/armv7/apk-tools-static-
2.10.8-r0.apk


/ # ln sbin/apk.static /bin/apk
/ # apk -V
apk-tools 2.10.8, compiled for armv7.

 % stty -echo -icanon && nc -U ~/Library/Containers/com.docker.docker/Data/vms/0/console.sock
docker-desktop:~#
docker-desktop:~# [38019.885752] overlayfs: upper fs does not support tmpfile.
[38024.789745] overlayfs: upper fs does not support tmpfile.
[326:15:09:15.047][I] guest: still waiting for osxfs-data after 10h33m40.000926693


https://gist.github.com/BretFisher/5e1a0c7bcca4c735e716abf62afad389


Option 1 (hard way): use netcat
nc -U ~/Library/Containers/com.docker.docker/Data/debug-shell.sock

Exit the shell with exit.

Option 2 (easier): Use nsenter in priviledged container
docker run -it --privileged --pid=host debian nsenter -t 1 -m -u -n -i sh

Phil Estes (Docker Maintainer) says:

it’s running a container (using the debian image. nothing special about it other than it apparently has nsenter installed), with pid=host (so you are in the process space of the mini VM running Docker4Mac), and then nsenter says “whatever is pid 1, use that as context, and enter all the namespaces of that, and run a shell there"

Option 3 (easist): run nsenter from a pre-built image. From Justin Cormack (Docker Maintainer)
docker run -it --rm --privileged --pid=host justincormack/nsenter1



docker pull alpine:latest

https://registry.hub.docker.com/_/alpine/?tab=tags&page=1

% docker run -it --privileged --pid=host alpine:latest nsenter -t 1 -m -u -n -i sh
/ #


/ # apk add git
ERROR: Unable to lock database: Read-only file system

https://github.com/docker/for-mac/issues/2419

